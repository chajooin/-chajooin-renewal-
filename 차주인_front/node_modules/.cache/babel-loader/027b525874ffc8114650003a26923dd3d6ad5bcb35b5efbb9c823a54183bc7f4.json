{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{useDispatch,useSelector}from\"react-redux\";import{Link,useNavigate,useParams}from'react-router-dom';import\"../../css/my/my-point.css\";import Layout from\"../../layout/Layout\";import Button from'../../component/Button';import MyNavigator from\"./components/MyNavigator\";import*as APIS from\"../../utils/service\";import consts from\"../../libs/consts\";import{Ismobiles,dateMinformat,dateformat,goBackPage,numFormat}from'../../utils/utils';import{close,loadingflas,open}from'../../redux/popupSlice';import{selectPointInfo,setPointList}from'../../redux/pointSlice';import{API_URL}from'../../libs/apiUrl';import{loadUserInfo,selectUserInfo,setUserInfoTest}from'../../redux/userSlice';import{selectConfig}from'../../redux/configSlice';import{ChargePoint,ExchangePoint}from'../../component/popups/Point';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function MyPoint(_ref){var _UserData$userInfo,_UserData$userInfo2,_UserData$userInfo3,_UserData$userInfo4,_PointData$listType,_PointData$listType2,_PointData$listType3,_PointData$listType4;let{navigation}=_ref;const dispatch=useDispatch();const navigate=useNavigate();const params=new URLSearchParams(window.location.search);const ConfigData=useSelector(selectConfig);const UserData=useSelector(selectUserInfo);const PointData=useSelector(selectPointInfo);const[isLogin,setIsLogin]=useState(false);const[tabIndex,setTabIndex]=useState(1);const[isNone,setNone]=useState(false);const[chargeItem,setChargeItem]=useState(null);const[exchangeData,setExchangeData]=useState(null);const[sendCharge,setSendCharge]=useState(0);const[sendExchange,setSendExchange]=useState(0);const loadData=typeIndex=>{setNone(false);APIS.postData(API_URL.point.list,{type:typeIndex}).then(result=>{if(result.data&&result.data.length<=0){dispatch(setPointList({type:tabIndex,list:[]}));setNone(true);}else{dispatch(setPointList({type:tabIndex,list:result.data}));}}).catch(()=>{});};//충전하기\nconst requestCharge=()=>{console.log(\"충전::\",chargeItem);if(chargeItem&&sendCharge>0){// let newWindow = window.open(\"/payLoading\", \"new\", \"width=430, height=555, resizable=no, scrollbars=no, status=no;\")\n// return\n// dispatch(loadingflas({ loading: true }))\nAPIS.postData(API_URL.point.charge,{key:chargeItem.idx}).then(result=>{let data=result.data;if(Ismobiles())window.open(data.mobile_url,\"new\");else window.open(data.online_url,\"new\",\"width=430, height=555, resizable=no, scrollbars=no, status=no;\");//결제 완료되었을때\ndispatch(loadUserInfo());loadData(tabIndex);}).catch(()=>{console.log(\"결제 실패\");});}};const msgPopup=text=>{if(text)dispatch(open({content:text,button:\"확인\",titleviewer:false,onPress:()=>{dispatch(close());}}));};//환전하기\nconst requestExChange=()=>{if(exchangeData&&sendExchange>0){console.log(\"정산::\",exchangeData);console.log(\"point:\",exchangeData===null||exchangeData===void 0?void 0:exchangeData.point);console.log(\"bank:\",exchangeData===null||exchangeData===void 0?void 0:exchangeData.bank);console.log(\"bank_num:\",exchangeData===null||exchangeData===void 0?void 0:exchangeData.bank_num);console.log(\"bank_name:\",exchangeData===null||exchangeData===void 0?void 0:exchangeData.bank_name);if((exchangeData===null||exchangeData===void 0?void 0:exchangeData.point)<10000){// console.log(\"🚀 ~ requestExChange ~ exchangeData?.point:\", exchangeData?.point);\nmsgPopup(\"1만 포인트 이상부터 정산가능합니다.\");return;}else if((exchangeData===null||exchangeData===void 0?void 0:exchangeData.bank)<0){msgPopup(\"은행명을 선택해주세요.\");return;}else if(!(exchangeData!==null&&exchangeData!==void 0&&exchangeData.bank_num)||(exchangeData===null||exchangeData===void 0?void 0:exchangeData.bank_num)==\"\"){msgPopup(\"계좌번호를 입력해주세요.\");return;}else if(!(exchangeData!==null&&exchangeData!==void 0&&exchangeData.bank_name)||(exchangeData===null||exchangeData===void 0?void 0:exchangeData.bank_name)==\"\"){msgPopup(\"예금주명을 입력해주세요.\");return;}APIS.postData(API_URL.point.exchange,{...exchangeData}).then(result=>{console.log(\"🚀 ~ .then ~ result:\",result.data);dispatch(open({content:'정산 요청되었습니다.',button:\"확인\",titleviewer:false,onPress:()=>{dispatch(close());}}));loadData(tabIndex);}).catch(e=>{console.log(\"정산 실패\",e);dispatch(open({content:\"\".concat(e.response.msg?e.response.msg:\"정산요청 실패\"),button:\"확인\",titleviewer:false,onPress:()=>{dispatch(close());}}));});}};const getState=status=>{var _ConfigData$configInf,_ConfigData$configInf2,_ConfigData$configInf3;let index=0;let data=(_ConfigData$configInf=ConfigData.configInfo)===null||_ConfigData$configInf===void 0?void 0:(_ConfigData$configInf2=_ConfigData$configInf.consts)===null||_ConfigData$configInf2===void 0?void 0:(_ConfigData$configInf3=_ConfigData$configInf2.exchangeStatusConsts)===null||_ConfigData$configInf3===void 0?void 0:_ConfigData$configInf3.find((v,i)=>{index=i;return v.idx==status;});let color=\"\";if(index==0){color=\"blue\";}if(index==1){color=\"\";}if(index==2){color=\"red\";}return{title:data.title,color};};useEffect(()=>{console.log(\"render point!\");let token=localStorage.getItem(\"token\");setIsLogin(token?true:false);if(params.get(\"tab\")){let tab=Number(params.get(\"tab\"));if(!isNaN(tab)&&[1,2,3,4].indexOf(tab)>=0)setTabIndex(tab);}},[]);useEffect(()=>{loadData(tabIndex);},[tabIndex]);useEffect(()=>{requestCharge();},[sendCharge]);useEffect(()=>{requestExChange();},[sendExchange]);return/*#__PURE__*/_jsx(Layout,{header:false,footters:false,children:/*#__PURE__*/_jsxs(\"div\",{className:\"myPointContain\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"global-titleBox bg_white fixed\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"/images/icons/back.svg\",alt:\"\",onClick:()=>{// console.log(window.history)\n// goBackPage(navigate);\nnavigate(\"/mypage\",{replace:true});}}),/*#__PURE__*/_jsx(\"div\",{className:\"titleInfo\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text\",onClick:()=>dispatch(setUserInfoTest({value:2})),children:\"\\uD3EC\\uC778\\uD2B8\"})}),isLogin&&/*#__PURE__*/_jsx(\"div\",{className:\"quick-alamContain\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"box\",onClick:()=>{navigate(\"/message\");},children:[/*#__PURE__*/_jsx(\"img\",{src:\"/images/icons/mail-line.svg\",alt:\"\"}),Number((_UserData$userInfo=UserData.userInfo)===null||_UserData$userInfo===void 0?void 0:_UserData$userInfo.message_count)>0&&/*#__PURE__*/_jsx(\"div\",{className:\"num\",children:(_UserData$userInfo2=UserData.userInfo)===null||_UserData$userInfo2===void 0?void 0:_UserData$userInfo2.message_count})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"infoBox margint60\",children:[/*#__PURE__*/_jsx(MyNavigator,{list:[{title:\"마이\"},{title:\"포인트\",isSelect:true}]}),/*#__PURE__*/_jsx(\"div\",{className:\"line\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"contents\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"point-box\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"title point\",children:\"\\uB098\\uC758 \\uD3EC\\uC778\\uD2B8\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"price\",children:[(_UserData$userInfo3=UserData.userInfo)!==null&&_UserData$userInfo3!==void 0&&_UserData$userInfo3.point?numFormat((_UserData$userInfo4=UserData.userInfo)===null||_UserData$userInfo4===void 0?void 0:_UserData$userInfo4.point,true):0,\"P\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"btn-box\",children:[/*#__PURE__*/_jsx(Button,{styles:{flex:1},buttonTxt:\"\\uCDA9\\uC804\\uD558\\uAE30\",buttonShape:\"white\",onPress:()=>{var _ConfigData$configInf4,_ConfigData$configInf5,_ConfigData$configInf6,_ConfigData$configInf7,_ConfigData$configInf8;if((_ConfigData$configInf4=ConfigData.configInfo)!==null&&_ConfigData$configInf4!==void 0&&(_ConfigData$configInf5=_ConfigData$configInf4.consts)!==null&&_ConfigData$configInf5!==void 0&&_ConfigData$configInf5.exchangeStatusConsts&&((_ConfigData$configInf6=ConfigData.configInfo)===null||_ConfigData$configInf6===void 0?void 0:(_ConfigData$configInf7=_ConfigData$configInf6.consts)===null||_ConfigData$configInf7===void 0?void 0:(_ConfigData$configInf8=_ConfigData$configInf7.exchangeStatusConsts)===null||_ConfigData$configInf8===void 0?void 0:_ConfigData$configInf8.length)>0){var _ConfigData$configInf9,_ConfigData$configInf10,_ConfigData$configInf11,_ConfigData$configInf12;setChargeItem((_ConfigData$configInf9=ConfigData.configInfo)===null||_ConfigData$configInf9===void 0?void 0:(_ConfigData$configInf10=_ConfigData$configInf9.consts)===null||_ConfigData$configInf10===void 0?void 0:_ConfigData$configInf10.exchangeStatusConsts[0]);dispatch(open({title:\"포인트 충전하기\",titleviewer:true,component:/*#__PURE__*/_jsx(ChargePoint,{items:(_ConfigData$configInf11=ConfigData.configInfo)===null||_ConfigData$configInf11===void 0?void 0:(_ConfigData$configInf12=_ConfigData$configInf11.consts)===null||_ConfigData$configInf12===void 0?void 0:_ConfigData$configInf12.payPriceConsts,onChange:item=>{setChargeItem(item);}}),button:\"충전하기\",onPress:()=>{dispatch(close());setSendCharge(sendCharge+1);},noneMt:true}));}else{dispatch(open({component:'결제 준비중입니다.',button:\"확인\",alert:false,onPress:()=>{dispatch(close());}}));}}}),/*#__PURE__*/_jsx(Button,{styles:{flex:1},buttonTxt:\"\\uC815\\uC0B0\\uC2E0\\uCCAD\",onPress:()=>{var _UserData$userInfo5,_UserData$userInfo6;setExchangeData({});dispatch(open({title:\"정산 신청\",titleviewer:true,component:/*#__PURE__*/_jsx(ExchangePoint,{point:(_UserData$userInfo5=UserData.userInfo)!==null&&_UserData$userInfo5!==void 0&&_UserData$userInfo5.point?(_UserData$userInfo6=UserData.userInfo)===null||_UserData$userInfo6===void 0?void 0:_UserData$userInfo6.point:0,banks:consts.bankList,onChange:data=>{setExchangeData(data);}}),button:\"정산 신청하기\",alert:true,buttonCencle:\"취소\",onPress:()=>{dispatch(close());setSendExchange(sendExchange+1);},onCancelPress:()=>{dispatch(close());},noneMt:true}));}})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"tab-menu-box\",children:[\"충전내역\",\"지급내역\",\"사용내역\",\"정산내역\"].map((v,i)=>{{/* {[\"충전내역\", \"지급내역\", \"사용내역\"].map((v, i) => { */}return/*#__PURE__*/_jsx(\"div\",{className:\"tab-menu \".concat(i+1===tabIndex&&\"select\"),onClick:()=>{setTabIndex(i+1);},children:v});})}),/*#__PURE__*/_jsxs(\"div\",{className:\"list-box\",children:[tabIndex==1&&/*#__PURE__*/_jsx(_Fragment,{children:PointData===null||PointData===void 0?void 0:(_PointData$listType=PointData.listType1)===null||_PointData$listType===void 0?void 0:_PointData$listType.map((v,i)=>/*#__PURE__*/_jsxs(\"div\",{className:\"list-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"title-box\",children:/*#__PURE__*/_jsx(\"div\",{className:\"title\",children:dateMinformat(v===null||v===void 0?void 0:v.create_dt)})}),/*#__PURE__*/_jsx(\"div\",{className:\"value-box\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"value\",children:[numFormat(v===null||v===void 0?void 0:v.point,true),\"P\"]})})]}))}),tabIndex==2&&/*#__PURE__*/_jsx(_Fragment,{children:PointData===null||PointData===void 0?void 0:(_PointData$listType2=PointData.listType2)===null||_PointData$listType2===void 0?void 0:_PointData$listType2.map((v,i)=>/*#__PURE__*/_jsxs(\"div\",{className:\"list-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"title-box\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"title\",children:dateMinformat(v===null||v===void 0?void 0:v.create_dt)}),/*#__PURE__*/_jsx(\"div\",{className:\"title bold\",children:v===null||v===void 0?void 0:v.title})]}),/*#__PURE__*/_jsx(\"div\",{className:\"value-box\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"value\",children:[numFormat((v===null||v===void 0?void 0:v.point)*(i+1),true),\"P\"]})})]}))}),tabIndex==3&&/*#__PURE__*/_jsx(_Fragment,{children:PointData===null||PointData===void 0?void 0:(_PointData$listType3=PointData.listType3)===null||_PointData$listType3===void 0?void 0:_PointData$listType3.map((v,i)=>/*#__PURE__*/_jsxs(\"div\",{className:\"list-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"title-box\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"title\",children:dateMinformat(v===null||v===void 0?void 0:v.create_dt)}),/*#__PURE__*/_jsx(\"div\",{className:\"title bold\",children:v===null||v===void 0?void 0:v.title})]}),/*#__PURE__*/_jsx(\"div\",{className:\"value-box\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"value red\",children:[\"-\",numFormat(v===null||v===void 0?void 0:v.point,true),\"P\"]})})]}))}),tabIndex==4&&/*#__PURE__*/_jsx(_Fragment,{children:PointData===null||PointData===void 0?void 0:(_PointData$listType4=PointData.listType4)===null||_PointData$listType4===void 0?void 0:_PointData$listType4.map((v,i)=>/*#__PURE__*/_jsxs(\"div\",{className:\"list-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"title-box\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"title\",children:dateformat(v===null||v===void 0?void 0:v.create_dt)}),/*#__PURE__*/_jsx(\"div\",{className:\"title error\",children:v===null||v===void 0?void 0:v.msg})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"value-box\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"value\",children:[numFormat(v===null||v===void 0?void 0:v.point,true),\"\\uC6D0\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"state \".concat(getState(v===null||v===void 0?void 0:v.status).color),children:getState(v.status).title})]})]}))}),isNone&&/*#__PURE__*/_jsx(\"div\",{className:\"none-list\",children:\"\\uB0B4\\uC5ED\\uC774 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"})]})]})]})]})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}