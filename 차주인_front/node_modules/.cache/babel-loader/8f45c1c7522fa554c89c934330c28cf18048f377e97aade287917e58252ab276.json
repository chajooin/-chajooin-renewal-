{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{useDispatch,useSelector}from\"react-redux\";import{Link,useLocation,useNavigate}from'react-router-dom';import{open,close,loadingflas,showLoginPopup}from'../../redux/popupSlice';import\"../../css/page-rented.css\";import Layout from\"../../layout/Layout\";import Selector from\"../../component/Select\";import Button from\"../../component/Button\";import*as APIS from\"../../utils/service\";import{API_URL}from'../../libs/apiUrl';import{AutoSizer,List,WindowScroller}from'react-virtualized';import{numFormat}from'../../utils/utils';import{DefaultImg}from'../../component/DefaultImg';import consts from\"../../libs/consts\";import{TextCheckBox}from'../../component/TextCheck';import{CheckItemOption,CheckOption,CheckUnloadinOption,LengthOption,MadeOption,NumberOption,PayOption,PayTypeOption,PriceOption,SidoOption,TypeOption,YearOption}from'../../component/popups/CarOption';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function RentedCar(_ref){let{navigation}=_ref;const dispatch=useDispatch();const navigate=useNavigate();const location=useLocation();const[isLogin,setLogin]=useState(localStorage.getItem(\"token\")?true:false);const[srRowHeight,setSrRowHeight]=useState(258);const[jeeipList,setJeeipList]=useState([]);const[viewList,setViewList]=useState([]);const[order,setOrder]=useState(1);const[isMyView,setIsMyView]=useState(false);const[filterSido,setFilterSido]=useState(\"\");const[filterCar,setFilterCar]=useState({maker:'',car:''});const[filterType,setFilterType]=useState({range:{min:null,max:null},ton:\"\",carType:\"\"});const[filterPay,setFilterPay]=useState({min:null,max:null});const[filterpaytype,setfilterpaytype]=useState(\"\");const[filterPrice,setFilterPrice]=useState({min:null,max:null});const[filterLicense,setFilterLicense]=useState([]);const[filterItem,setFilterItem]=useState([]);const[filterUnloading,setFilterUnloading]=useState([]);useEffect(()=>{filterList();},[filterSido,filterCar,filterType,filterPay,filterpaytype,filterPrice,filterLicense,filterItem,filterUnloading]);const filterList=()=>{let filterData=jeeipList.filter(v=>{let isSelect=true;if(filterSido&&v.go_sido!=filterSido)isSelect=false;if(filterCar.maker&&v.maker!=filterCar.maker){isSelect=false;}if(filterCar.car&&v.car!=filterCar.car){isSelect=false;}if(filterType.ton){if(filterType.ton!=Number(v.ton))isSelect=false;}else{if(filterType.range.min&&(filterType.range.min>Number(v.ton)||filterType.range.max<Number(v.ton))){isSelect=false;}}if(filterType.carType&&filterType.carType!=v.type){isSelect=false;}if(filterPay.min&&Number(v.pay)<Number(filterPay.min))isSelect=false;if(filterPay.max&&Number(v.pay)>Number(filterPay.max))isSelect=false;if(filterpaytype&&v.paytype!=filterpaytype)isSelect=false;if(filterPrice.min&&Number(v.price)<Number(filterPrice.min))isSelect=false;if(filterPrice.max&&Number(v.price)>Number(filterPrice.max))isSelect=false;if(filterLicense.length>0&&filterLicense.indexOf(v.license_type)<0)isSelect=false;if(filterItem.length>0&&filterItem.indexOf(v.item)<0)isSelect=false;if(filterUnloading.length>0){let isItemCheck=false;for(let item of String(v===null||v===void 0?void 0:v.unloading).split(\",\")){if(filterUnloading.indexOf(item)>=0){isItemCheck=true;break;}}for(let item of String(v===null||v===void 0?void 0:v.unloading2).split(\",\")){if(filterUnloading.indexOf(item)>=0){isItemCheck=true;break;}}if(!isItemCheck)isSelect=false;}return isSelect;});setViewList(filterData);};const loadCar=async()=>{let result={error:null,data:[]};const loadSubList=maker=>{return new Promise(res=>{APIS.postData(API_URL.commom.car,{maker}).then(carResult=>{var _carResult$data;if((carResult===null||carResult===void 0?void 0:(_carResult$data=carResult.data)===null||_carResult$data===void 0?void 0:_carResult$data.length)>0){res(carResult===null||carResult===void 0?void 0:carResult.data);}else{res([]);}}).catch(e=>{res([]);});});};return new Promise((resolve,reject)=>{APIS.postData(API_URL.commom.maker).then(async makerResult=>{var _makerResult$data;if((makerResult===null||makerResult===void 0?void 0:(_makerResult$data=makerResult.data)===null||_makerResult$data===void 0?void 0:_makerResult$data.length)>0){let mlist=makerResult===null||makerResult===void 0?void 0:makerResult.data;for(let i in mlist){let cars=await loadSubList(mlist[i]);if(cars.length>0){result.data.push({maker:mlist[i],cars:cars});}}resolve(result);}else{result.error=\"제조사 데이터가 없습니다.\";resolve(result);}}).catch(()=>{result.error=\"제조사 데이터가 없습니다.\";resolve(result);});});};const categoryClick=async index=>{if(index==6){dispatch(open({component:/*#__PURE__*/_jsx(SidoOption,{setValue:filterSido,onChange:setFilterSido}),onCancelPress:false,titleviewer:true,title:\"운행지역\",button:\"초기화\",buttonStyle:\"reset\",onPress:()=>{dispatch(close());setFilterSido(\"\");},noneMt:true}));}else if(index==0){let carData=await loadCar();//{ values: \"aa\", labels: \"asdas\" }\nif(!carData.err){dispatch(open({component:/*#__PURE__*/_jsx(MadeOption,{carDatas:carData.data,setValue:filterCar,onChange:v=>{setFilterCar(v);}}),onCancelPress:false,titleviewer:true,title:\"제조사/차종\",button:\"초기화\",buttonStyle:\"reset\",onPress:()=>{dispatch(close());setFilterCar({maker:'',car:''});},noneMt:true}));}else{//제조사/차종 정보 없을경우 처리 - 리셋 \nsetFilterCar({maker:'',car:''});}}else if(index==1){dispatch(open({component:/*#__PURE__*/_jsx(TypeOption,{setValue:filterType,onChange:v=>{console.log(v);setFilterType(v);}}),onCancelPress:false,titleviewer:true,title:\"형태\",button:\"초기화\",buttonStyle:\"reset\",onPress:()=>{dispatch(close());setFilterType({range:{min:null,max:null},ton:\"\",carType:\"\"});},noneMt:true}));}else if(index==2){dispatch(open({component:/*#__PURE__*/_jsx(PayOption,{setValue:filterPay,onChange:v=>{setFilterPay(v);}}),onCancelPress:false,titleviewer:true,title:\"급여\",button:\"초기화\",buttonStyle:\"reset\",onPress:()=>{dispatch(close());setFilterPay({min:null,max:null});},noneMt:true}));}else if(index==3){dispatch(open({component:/*#__PURE__*/_jsx(PayTypeOption,{setValue:filterpaytype,onChange:v=>{setfilterpaytype(v);}}),onCancelPress:false,titleviewer:true,title:\"지급방식\",button:\"초기화\",buttonStyle:\"reset\",onPress:()=>{dispatch(close());setfilterpaytype(\"\");},noneMt:true}));}else if(index==4){dispatch(open({component:/*#__PURE__*/_jsx(PriceOption,{setValue:filterPrice,onChange:v=>{setFilterPrice(v);}}),onCancelPress:false,titleviewer:true,title:\"인수금액\",button:\"초기화\",buttonStyle:\"reset\",onPress:()=>{dispatch(close());setFilterPrice({min:null,max:null});},noneMt:true}));}else if(index==5){dispatch(open({component:/*#__PURE__*/_jsx(NumberOption,{setValue:filterLicense,onChange:setFilterLicense}),onCancelPress:false,titleviewer:true,title:\"넘버승계\",button:\"초기화\",buttonStyle:\"reset\",onPress:()=>{dispatch(close());setFilterLicense([]);},noneMt:true}));}else if(index==7){dispatch(open({component:/*#__PURE__*/_jsx(CheckItemOption,{setValue:filterItem,onChange:setFilterItem}),onCancelPress:false,titleviewer:true,title:\"품목\",button:\"초기화\",buttonStyle:\"reset\",onPress:()=>{dispatch(close());setFilterItem([]);},noneMt:true}));}else if(index==8){dispatch(open({component:/*#__PURE__*/_jsx(CheckUnloadinOption,{setValue:filterUnloading,onChange:setFilterUnloading}),onCancelPress:false,titleviewer:true,title:\"상하차방법\",button:\"초기화\",buttonStyle:\"reset\",onPress:()=>{dispatch(close());setFilterUnloading([]);},noneMt:true}));}};//윈도우 가로사이즈 체크\nconst checkWindowWidth=()=>{const width=window.innerWidth;if(width<1000){setSrRowHeight(552);}else{setSrRowHeight(258);}};const loadList=()=>{dispatch(loadingflas({loading:true}));APIS.postData(API_URL.rentedCar.list,{order:order*1,my:isMyView}).then(result=>{console.log(\"🚀 ~ .then ~ result:\",result.data);dispatch(loadingflas({loading:false}));setJeeipList(result.data);}).catch(e=>{dispatch(loadingflas({loading:false}));console.log(e.response);});};useEffect(()=>{console.log(\"render rentedCar!!\");if(location.state){if(location.state.isMyView)setIsMyView(true);}checkWindowWidth();window.onresize=function(){checkWindowWidth();};},[]);useEffect(()=>{console.log(\"🚀 jeeipList:\",jeeipList);filterList();},[jeeipList]);useEffect(()=>{loadList();},[order,isMyView]);return/*#__PURE__*/_jsx(Layout,{header:true,actives:\"rentedCar\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"rentedCarContain\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"categoryBox\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"categoryBtn \".concat(filterSido&&\"select\"),onClick:()=>categoryClick(6),children:\"\\uC6B4\\uD589\\uC9C0\\uC5ED\"}),/*#__PURE__*/_jsx(\"div\",{className:\"categoryBtn \".concat(filterCar.maker&&\"select\"),onClick:()=>categoryClick(0),children:\"\\uC81C\\uC870\\uC0AC/\\uCC28\\uC885\"}),/*#__PURE__*/_jsx(\"div\",{className:\"categoryBtn \".concat((filterType.range.min||filterType.ton||filterType.carType)&&\"select\"),onClick:()=>categoryClick(1),children:\"\\uD615\\uD0DC\"}),/*#__PURE__*/_jsx(\"div\",{className:\"categoryBtn \".concat((filterPay.min||filterPay.max)&&\"select\"),onClick:()=>categoryClick(2),children:\"\\uAE09\\uC5EC\"}),/*#__PURE__*/_jsx(\"div\",{className:\"categoryBtn \".concat(filterpaytype&&\"select\"),onClick:()=>categoryClick(3),children:\"\\uC9C0\\uAE09\\uBC29\\uC2DD\"}),/*#__PURE__*/_jsx(\"div\",{className:\"categoryBtn \".concat((filterPrice.min||filterPrice.max)&&\"select\"),onClick:()=>categoryClick(4),children:\"\\uC778\\uC218\\uAE08\\uC561\"}),/*#__PURE__*/_jsx(\"div\",{className:\"categoryBtn \".concat(filterLicense.length>0&&\"select\"),onClick:()=>categoryClick(5),children:\"\\uB118\\uBC84\\uC2B9\\uACC4\"}),/*#__PURE__*/_jsx(\"div\",{className:\"categoryBtn \".concat(filterItem.length>0&&\"select\"),onClick:()=>categoryClick(7),children:\"\\uD488\\uBAA9\"}),/*#__PURE__*/_jsx(\"div\",{className:\"categoryBtn \".concat(filterUnloading.length>0&&\"select\"),onClick:()=>categoryClick(8),children:\"\\uC0C1\\uD558\\uCC28\\uBC29\\uBC95\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"subCategoryBox\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",alignItems:\"center\",gap:10},children:[/*#__PURE__*/_jsx(Selector,{subselectClass:\"selBox\",values:order,setValues:setOrder,selectData:[{values:1,labels:\"최신순\"},{values:2,labels:\"조회순\"},{values:3,labels:\"관심순\"},{values:4,labels:\"낮은가격순\"},{values:5,labels:\"높은가격순\"}]}),/*#__PURE__*/_jsx(TextCheckBox,{name:\"bmv-check\",text:\"\\uB0B4 \\uAE00 \\uBCF4\\uAE30\",isIcon:true,checked:isMyView,onChange:v=>{setIsMyView(v);}})]}),/*#__PURE__*/_jsx(\"div\",{className:\"sellbtn\",children:/*#__PURE__*/_jsx(Button,{titleimgs:\"/images/icons/plus.svg\",buttonTxt:\"\\uC9C0\\uC785 \\uB4F1\\uB85D\",onPress:()=>{if(isLogin)navigate(\"/rentedCarAdd\");else dispatch(showLoginPopup({onPress:()=>{dispatch(close());navigate(\"/login\");}}));}})})]}),/*#__PURE__*/_jsx(WindowScroller,{children:_ref2=>{let{height,scrollTop,isScrolling,onChildScroll}=_ref2;return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(AutoSizer,{disableHeight:true,children:_ref3=>{let{width}=_ref3;return/*#__PURE__*/_jsx(List,{ref:el=>{window.listEl=el;},autoHeight:true,height:height,isScrolling:isScrolling,onScroll:onChildScroll,overscanRowCount:2,rowCount:viewList.length,rowHeight:srRowHeight,rowRenderer:_ref4=>{let{index,isScrolling,isVisible,key,style}=_ref4;let row=viewList[index];return/*#__PURE__*/_jsx(\"div\",{style:style,children:/*#__PURE__*/_jsxs(\"div\",{className:\"card\",onClick:()=>{if(isLogin)window.open(\"rentedCarInfo?idx=\".concat(row===null||row===void 0?void 0:row.idx));else dispatch(showLoginPopup({onPress:()=>{dispatch(close());navigate(\"/login\");}}));},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"contents\",children:[/*#__PURE__*/_jsxs(\"div\",{class:\"info\",children:[/*#__PURE__*/_jsxs(\"div\",{class:\"content-f\",children:[/*#__PURE__*/_jsxs(\"div\",{class:\"type fontsize14 color3B4894\",children:[row===null||row===void 0?void 0:row.ton,\"\\uD1A4 \",row===null||row===void 0?void 0:row.type]}),/*#__PURE__*/_jsx(\"div\",{class:\"price margint12\",children:/*#__PURE__*/_jsxs(\"span\",{class:\"fontsize20 color666\",children:[/*#__PURE__*/_jsx(\"span\",{class:\"fontsize36 color3B4894 bolds\",children:(row===null||row===void 0?void 0:row.license_sell)==1?numFormat((row===null||row===void 0?void 0:row.price)+(row===null||row===void 0?void 0:row.license_price)):numFormat(row===null||row===void 0?void 0:row.price)}),\" \\uB9CC\\uC6D0\"]})})]}),/*#__PURE__*/_jsxs(\"div\",{class:\"content-s\",children:[/*#__PURE__*/_jsxs(\"div\",{class:\"cinfo\",children:[/*#__PURE__*/_jsx(\"div\",{class:\"ci-title fontsize16 color666\",children:\"\\uC6B4\\uD589\\uC9C0\\uC5ED\"}),/*#__PURE__*/_jsxs(\"div\",{class:\"ci-text fontsize16 bolds\",children:[row===null||row===void 0?void 0:row.sido,\" \",row===null||row===void 0?void 0:row.sigungu]})]}),/*#__PURE__*/_jsxs(\"div\",{class:\"cinfo\",children:[/*#__PURE__*/_jsx(\"div\",{class:\"ci-title fontsize16 color666\",children:\"\\uC2DC\\uAC04\"}),/*#__PURE__*/_jsx(\"div\",{class:\"ci-text fontsize16 bolds\",children:row===null||row===void 0?void 0:row.work})]}),/*#__PURE__*/_jsxs(\"div\",{class:\"cinfo\",children:[/*#__PURE__*/_jsx(\"div\",{class:\"ci-title fontsize16 color666\",children:\"\\uAE09\\uC5EC\"}),/*#__PURE__*/_jsxs(\"div\",{class:\"ci-text fontsize16 bolds\",children:[numFormat(row===null||row===void 0?void 0:row.pay),\"\\uB9CC\\uC6D0[\",row===null||row===void 0?void 0:row.paytype,\"]\"]})]}),/*#__PURE__*/_jsxs(\"div\",{class:\"cinfo\",children:[/*#__PURE__*/_jsx(\"div\",{class:\"ci-title fontsize16 color666\",children:\"\\uC778\\uC218\\uAE08\"}),/*#__PURE__*/_jsxs(\"div\",{class:\"ci-text fontsize16 bolds\",children:[numFormat(row===null||row===void 0?void 0:row.price),\"\\uB9CC\\uC6D0\"]})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"adBox\",children:row===null||row===void 0?void 0:row.title})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"img-box\",children:[/*#__PURE__*/_jsx(\"img\",{src:consts.s3url+(row===null||row===void 0?void 0:row.thumb),alt:\"\",onError:DefaultImg}),(row===null||row===void 0?void 0:row.status)===2&&/*#__PURE__*/_jsx(\"div\",{className:\"soldout-box\",children:\"\\uD310\\uB9E4\\uC644\\uB8CC\"})]})]})},key);},scrollToIndex:0,scrollTop:scrollTop,width:width});}})});}})]})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}