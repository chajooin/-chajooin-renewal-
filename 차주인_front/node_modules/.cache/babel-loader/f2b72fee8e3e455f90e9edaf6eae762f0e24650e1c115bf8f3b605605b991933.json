{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{useDispatch,useSelector}from\"react-redux\";import{Link,useNavigate,useParams}from'react-router-dom';import\"../../css/quick-menu.css\";import Layout from\"../../layout/Layout\";import Button from'../../component/Button';import{MessageBox}from\"../../component/popups/MessageBox\";import*as APIS from\"../../utils/service\";import consts from\"../../libs/consts\";import{close,open}from'../../redux/popupSlice';import{API_URL}from'../../libs/apiUrl';import{loadUserInfo}from'../../redux/userSlice';import{dateMinformat}from'../../utils/utils';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function PageHeart(_ref){let{navigation}=_ref;const dispatch=useDispatch();const navigate=useNavigate();const params=useParams();const[tabIndex,setTabIndex]=useState(1);const[list,setList]=useState([]);const[sendMsg,setSendMsg]=useState({idx:0,msg:\"\"});const[isSend,setIsSend]=useState(false);useEffect(()=>{loadList(tabIndex);},[tabIndex]);useEffect(()=>{if(isSend){sendMessage();setIsSend(false);}},[isSend]);const loadList=type=>{setList([]);APIS.postData(API_URL.user.message,{type}).then(result=>{console.log(\"🚀 ~ .then ~ result:\",result.data);setList(result.data);}).catch(e=>{console.log(e.responce);});};const sendMessage=()=>{if(sendMsg.msg){APIS.postData(API_URL.user.sendMessage,{target_idx:sendMsg.idx,desc:sendMsg.msg.replaceAll(\"\\n\",\"<br>\")}).then(result=>{loadList(tabIndex);}).catch(e=>{console.log(e.responce);loadList(tabIndex);});}};const delItem=idx=>{if(idx){APIS.postData(API_URL.user.delMessage,{idx}).then(result=>{loadList(tabIndex);dispatch(loadUserInfo());}).catch(e=>{console.log(e.responce);loadList(tabIndex);});}};useEffect(()=>{console.log(\"render!\");let timer=null;const handleScroll=()=>{if(timer){clearTimeout(timer);}timer=window.setTimeout(()=>{let totalScroll=document.documentElement.scrollHeight-document.documentElement.clientHeight;let curScroll=window.scrollY;if(totalScroll==window.scrollY){//마지막\n}},1000);};window.addEventListener(\"scroll\",handleScroll);return()=>[window.removeEventListener(\"scroll\",handleScroll)];},[]);const openPopup=v=>{setSendMsg({idx:0,msg:\"\"});let openData={button:\"답장 보내기\",buttonCencle:\"닫기\",onPress:()=>{setIsSend(true);dispatch(close());},onCancelPress:()=>{dispatch(close());}};if(tabIndex==1){var _v$user,_v$user2;openData.component=/*#__PURE__*/_jsx(MessageBox,{userImg:(_v$user=v.user)===null||_v$user===void 0?void 0:_v$user.profile,userName:(_v$user2=v.user)===null||_v$user2===void 0?void 0:_v$user2.name,date:dateMinformat(v.create_dt,false),sendMessage:\"\\uB2F5\\uC7A5 \\uBCF4\\uB0B4\\uAE30\",message:v.desc,isTrash:true,isWrite:true,onTrashClick:()=>{dispatch(close());delItem(v.idx);},noneMt:true,onChange:value=>{var _v$user3;setSendMsg({idx:(_v$user3=v.user)===null||_v$user3===void 0?void 0:_v$user3.idx,msg:value});}});}else if(tabIndex==2){var _v$targetUser,_v$targetUser2;openData.component=/*#__PURE__*/_jsx(MessageBox,{userImg:(_v$targetUser=v.targetUser)===null||_v$targetUser===void 0?void 0:_v$targetUser.profile,userName:(_v$targetUser2=v.targetUser)===null||_v$targetUser2===void 0?void 0:_v$targetUser2.name,date:dateMinformat(v.create_dt,false),message:v.desc,isTrash:true,onTrashClick:()=>{dispatch(close());delItem(v.idx);},noneMt:true});delete openData.onPress;delete openData.button;}dispatch(open(openData));};return/*#__PURE__*/_jsx(Layout,{header:true,footters:true,children:/*#__PURE__*/_jsxs(\"div\",{className:\"pageMessageContain\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"quick-menu-title-box\",children:/*#__PURE__*/_jsx(\"div\",{className:\"title\",children:\"\\uCABD\\uC9C0\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"tab-menu-box\",children:[\"받은 쪽지\",\"보낸 쪽지\"].map((v,i)=>{return/*#__PURE__*/_jsx(\"div\",{className:\"tab-menu \".concat(i+1===tabIndex&&\"select\"),onClick:()=>{setTabIndex(i+1);},children:v});})}),/*#__PURE__*/_jsxs(\"div\",{className:\"list-box\",children:[list.map((v,i)=>{var _v$user4,_v$user5,_v$targetUser3,_v$targetUser4,_v$user6,_v$targetUser5,_v$desc;return/*#__PURE__*/_jsxs(\"div\",{className:\"list-item\",onClick:()=>{openPopup(v);},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"icon-box\",children:[tabIndex==1&&((_v$user4=v.user)!==null&&_v$user4!==void 0&&_v$user4.profile?/*#__PURE__*/_jsx(\"img\",{src:consts.s3url+((_v$user5=v.user)===null||_v$user5===void 0?void 0:_v$user5.profile),alt:\"\"}):/*#__PURE__*/_jsx(\"img\",{src:\"/images/icons/user-test-icon.png\",alt:\"\"})),tabIndex==2&&((_v$targetUser3=v.targetUser)!==null&&_v$targetUser3!==void 0&&_v$targetUser3.profile?/*#__PURE__*/_jsx(\"img\",{src:consts.s3url+((_v$targetUser4=v.targetUser)===null||_v$targetUser4===void 0?void 0:_v$targetUser4.profile),alt:\"\"}):/*#__PURE__*/_jsx(\"img\",{src:\"/images/icons/user-test-icon.png\",alt:\"\"}))]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-box\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"name\",children:tabIndex===1?(_v$user6=v.user)===null||_v$user6===void 0?void 0:_v$user6.name:(_v$targetUser5=v.targetUser)===null||_v$targetUser5===void 0?void 0:_v$targetUser5.name}),/*#__PURE__*/_jsx(\"div\",{className:\"title\",children:(_v$desc=v.desc)===null||_v$desc===void 0?void 0:_v$desc.replaceAll(\"<br>\",\" \")})]}),/*#__PURE__*/_jsx(\"div\",{className:\"date\",children:dateMinformat(v.create_dt,false)})]});}),list.length<=0&&/*#__PURE__*/_jsx(\"div\",{className:\"quick-menu-noneitem\",children:\"\\uBAA9\\uB85D\\uC774 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"})]})]})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}