{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{useDispatch,useSelector}from\"react-redux\";import{Link,useNavigate,useParams}from'react-router-dom';import\"../../css/page-board.css\";import Layout from\"../../layout/Layout\";import Button from\"../../component/Button\";import consts from\"../../libs/consts\";import*as APIS from\"../../utils/service\";import{API_URL}from'../../libs/apiUrl';import{close,loadingflas,open}from'../../redux/popupSlice';import moment from'moment';import{elapsedTime,goBackPage}from'../../utils/utils';import{selectUserInfo}from'../../redux/userSlice';import{toast}from'react-toastify';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function BoardInfo(_ref){var _boardInfo$user,_UserData$userInfo,_boardInfo$user2,_boardInfo$files,_boardInfo$comment,_boardInfo$comment2,_boardInfo$comment3;let{navigation}=_ref;const dispatch=useDispatch();const navigate=useNavigate();const params=new URLSearchParams(window.location.search);const UserData=useSelector(selectUserInfo);const[boardInfo,setBoardInfo]=useState({});const[commentText,setCommentText]=useState(\"\");const[editId,setEditId]=useState(\"\");const[editComment,setEditComment]=useState(\"\");const loadData=function(){let init=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;dispatch(loadingflas({loading:true}));APIS.postData(API_URL.board.info,{idx:params.get(\"idx\"),init}).then(result=>{dispatch(loadingflas({loading:false}));// console.log(result.data)\nsetBoardInfo(result.data);}).catch(e=>{var _window$opener,_window$opener$locati;dispatch(loadingflas({loading:false}));(_window$opener=window.opener)===null||_window$opener===void 0?void 0:(_window$opener$locati=_window$opener.location)===null||_window$opener$locati===void 0?void 0:_window$opener$locati.reload();alert(\"게시물이 없습니다.\");window.close();navigate(\"/\",{replace:true});});};const deleteBoard=()=>{dispatch(open({content:\"게시글을 삭제하시겠습니까?\",onCancelPress:false,titleviewer:false,button:\"확인\",buttonCencle:\"닫기\",onPress:()=>{dispatch(close());APIS.postData(API_URL.board.delete,{idx:boardInfo===null||boardInfo===void 0?void 0:boardInfo.idx}).then(result=>{dispatch(loadingflas({loading:false}));alert(\"삭제되었습니다.\");// goBackPage(navigate);\nwindow.opener.location.reload();window.close();}).catch(e=>{dispatch(loadingflas({loading:false}));});},onCancelPress:()=>{dispatch(close());}}));};const sendComment=function(){let idx=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;let title=arguments.length>1?arguments[1]:undefined;if(!title){// console.log(\"내용을 입력하세요.\")\nreturn;}let sendData={b_idx:boardInfo===null||boardInfo===void 0?void 0:boardInfo.idx,idx:idx,title:title};APIS.postData(API_URL.board.commentInsert,sendData).then(result=>{dispatch(loadingflas({loading:false}));setCommentText(\"\");loadData(false);}).catch(e=>{dispatch(loadingflas({loading:false}));});};const deleteComment=function(){let idx=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!idx){// console.log(\"삭제할 댓글이 없음.\")\nreturn;}let sendData={idx:idx};dispatch(open({content:\"댓글을 삭제하시겠습니까?\",onCancelPress:false,titleviewer:false,button:\"확인\",buttonCencle:\"닫기\",onPress:()=>{dispatch(close());APIS.postData(API_URL.board.commentDelete,sendData).then(result=>{dispatch(loadingflas({loading:false}));toast(\"댓글이 삭제되었습니다.\");loadData(false);}).catch(e=>{dispatch(loadingflas({loading:false}));});},onCancelPress:()=>{dispatch(close());}}));};useEffect(()=>{loadData();},[]);return/*#__PURE__*/_jsx(Layout,{header:false,footters:false,children:/*#__PURE__*/_jsxs(\"div\",{className:\"boardInfoContain\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"global-titleBox bg_white fixed\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"/images/icons/back.svg\",alt:\"\",onClick:()=>{// goBackPage(navigate);\nwindow.close();navigate(\"/\",{replace:true});}}),/*#__PURE__*/_jsx(\"div\",{className:\"titleInfo\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text\",children:\"\\uC774\\uC804\\uC73C\\uB85C\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"infoBox\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"contentsBox\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"user-and-menu\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"user-info\",children:[boardInfo===null||boardInfo===void 0?void 0:(_boardInfo$user=boardInfo.user)===null||_boardInfo$user===void 0?void 0:_boardInfo$user.name,\" \",/*#__PURE__*/_jsx(\"span\",{children:moment(boardInfo===null||boardInfo===void 0?void 0:boardInfo.create_dt).format(\"YYYY.MM.DD HH:mm\")})]}),((_UserData$userInfo=UserData.userInfo)===null||_UserData$userInfo===void 0?void 0:_UserData$userInfo.idx)==(boardInfo===null||boardInfo===void 0?void 0:(_boardInfo$user2=boardInfo.user)===null||_boardInfo$user2===void 0?void 0:_boardInfo$user2.idx)&&/*#__PURE__*/_jsxs(\"div\",{class:\"drop-down\",children:[/*#__PURE__*/_jsx(\"button\",{class:\"drop-btn\"}),/*#__PURE__*/_jsxs(\"div\",{class:\"drop-down-content\",children:[/*#__PURE__*/_jsx(\"a\",{style:{cursor:\"pointer\"},onClick:()=>{navigate(\"/boardEdit?idx=\"+(boardInfo===null||boardInfo===void 0?void 0:boardInfo.idx));},children:\"\\uC218\\uC815\\uD558\\uAE30\"}),/*#__PURE__*/_jsx(\"a\",{style:{cursor:\"pointer\"},onClick:deleteBoard,children:\"\\uC0AD\\uC81C\\uD558\\uAE30\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"title\",children:boardInfo===null||boardInfo===void 0?void 0:boardInfo.title}),/*#__PURE__*/_jsx(\"div\",{className:\"image-box\",children:boardInfo===null||boardInfo===void 0?void 0:(_boardInfo$files=boardInfo.files)===null||_boardInfo$files===void 0?void 0:_boardInfo$files.map(v=>{return/*#__PURE__*/_jsx(\"img\",{src:consts.s3url+v,alt:\"\"});})}),/*#__PURE__*/_jsx(\"div\",{className:\"text-box\",dangerouslySetInnerHTML:{__html:boardInfo!==null&&boardInfo!==void 0&&boardInfo.desc?String(boardInfo===null||boardInfo===void 0?void 0:boardInfo.desc).replaceAll(\"\\n\",\"<br>\"):\"\"}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"comment-box\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"count\",children:[\"\\uB313\\uAE00 \",/*#__PURE__*/_jsx(\"span\",{className:\"num\",children:boardInfo===null||boardInfo===void 0?void 0:(_boardInfo$comment=boardInfo.comment)===null||_boardInfo$comment===void 0?void 0:_boardInfo$comment.length})]}),boardInfo===null||boardInfo===void 0?void 0:(_boardInfo$comment2=boardInfo.comment)===null||_boardInfo$comment2===void 0?void 0:_boardInfo$comment2.map(v=>{var _UserData$userInfo2;return/*#__PURE__*/_jsxs(\"div\",{className:\"comment-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"title\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-box\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"nick-name\",children:v===null||v===void 0?void 0:v.name}),/*#__PURE__*/_jsxs(\"span\",{className:\"time\",children:[\" \\xB7 \",elapsedTime(v===null||v===void 0?void 0:v.create_dt)]})]}),((_UserData$userInfo2=UserData.userInfo)===null||_UserData$userInfo2===void 0?void 0:_UserData$userInfo2.idx)==(v===null||v===void 0?void 0:v.u_idx)&&/*#__PURE__*/_jsxs(\"div\",{class:\"drop-down\",children:[/*#__PURE__*/_jsx(\"button\",{class:\"drop-btn\"}),/*#__PURE__*/_jsxs(\"div\",{class:\"drop-down-content\",children:[/*#__PURE__*/_jsx(\"a\",{style:{cursor:\"pointer\"},onClick:()=>{setEditId(v===null||v===void 0?void 0:v.idx);setEditComment(v===null||v===void 0?void 0:v.title);},children:\"\\uC218\\uC815\\uD558\\uAE30\"}),/*#__PURE__*/_jsx(\"a\",{style:{cursor:\"pointer\"},onClick:()=>{deleteComment(v===null||v===void 0?void 0:v.idx);},children:\"\\uC0AD\\uC81C\\uD558\\uAE30\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text\",children:editId==(v===null||v===void 0?void 0:v.idx)?/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",gap:8},children:[/*#__PURE__*/_jsx(\"input\",{style:{width:\"100%\",padding:5,border:\"1px solid #DDD\",borderRadius:4},type:\"text\",value:editComment,onChange:e=>{setEditComment(e.target.value);}}),/*#__PURE__*/_jsx(\"button\",{style:{padding:\"5px 10px\",flexShrink:0,fontSize:14,fontWeight:700,background:\"#3B4894\",color:\"#FFFFFF\",borderRadius:4},onClick:()=>{sendComment(v===null||v===void 0?void 0:v.idx,editComment);setEditId(\"\");},children:\"\\uC218\\uC815\"}),/*#__PURE__*/_jsx(\"button\",{style:{padding:\"5px 10px\",flexShrink:0,fontSize:14,fontWeight:700,background:\"#999\",color:\"#FFFFFF\",borderRadius:4},onClick:()=>{setEditId(\"\");},children:\"\\uCDE8\\uC18C\"})]}):v===null||v===void 0?void 0:v.title})]});}),(boardInfo===null||boardInfo===void 0?void 0:(_boardInfo$comment3=boardInfo.comment)===null||_boardInfo$comment3===void 0?void 0:_boardInfo$comment3.length)==0&&/*#__PURE__*/_jsx(\"div\",{className:\"no-comment\",children:\"\\uB313\\uAE00\\uC774 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"add-box\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"add-input\",placeholder:\"\\uB313\\uAE00 \\uB2EC\\uAE30...\",value:commentText,onChange:e=>{setCommentText(e.target.value);},type:\"text\"}),/*#__PURE__*/_jsx(\"button\",{className:\"add-btn\",onClick:()=>{sendComment(null,commentText);},children:\"\\uB4F1\\uB85D\"})]})]})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}