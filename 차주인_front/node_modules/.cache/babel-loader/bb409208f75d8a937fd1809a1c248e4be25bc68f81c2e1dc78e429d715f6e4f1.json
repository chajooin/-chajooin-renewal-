{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{useDispatch,useSelector}from\"react-redux\";import _ from\"lodash\";import Layout from\"../../layout/Layout\";import{open,close,loadingflas,showLoginPopup}from'../../redux/popupSlice';import{Link,useLocation,useNavigate}from'react-router-dom';import Selector from\"../../component/Select\";import Button from\"../../component/Button\";import*as APIS from\"../../utils/service\";import{LengthOption,MadeOption,NumberOption,PriceOption,TypeOption,YearOption}from'../../component/popups/CarOption';import{API_URL}from'../../libs/apiUrl';import{AutoSizer,CellMeasurer,CellMeasurerCache,List,WindowScroller}from'react-virtualized';import{dateShotYearformat,numFormat,useIntersectionObserver}from'../../utils/utils';import consts from\"../../libs/consts\";import{TextCheckBox}from'../../component/TextCheck';import{DefaultImg}from'../../component/DefaultImg';import{selectConfig}from'../../redux/configSlice';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const cache=new CellMeasurerCache({defaultWidth:100,fixedWidth:true});export default function UsedCar(_ref){let{navigation}=_ref;const dispatch=useDispatch();const navigate=useNavigate();const location=useLocation();const ConfigData=useSelector(selectConfig);const[isLogin,setLogin]=useState(localStorage.getItem(\"token\")?true:false);const[srRowHeight,setSrRowHeight]=useState(355);const[order,setOrder]=useState(1);const[truckList,setTruckList]=useState([]);const[viewList,setViewList]=useState([]);const[isMyView,setIsMyView]=useState(false);const[filterCar,setFilterCar]=useState({maker:'',car:''});const[filterType,setFilterType]=useState({range:{min:null,max:null},ton:\"\",carType:\"\"});const[filterYear,setFilterYear]=useState({min:null,max:null});const[filterDistance,setFilterDistance]=useState({min:null,max:null});const[filterPrice,setFilterPrice]=useState({min:null,max:null});const[filterLicense,setFilterLicense]=useState([]);const target=useRef(null);useEffect(()=>{filterList();},[filterCar,filterType,filterYear,filterDistance,filterPrice,filterLicense]);/**\n     * 제조사 차종 가져오기\n     * @returns {Promise<{error: null | string, data: {maker:string, cars:string[]}[]}>}\n     */const loadCar=async()=>{let result={error:null,data:[]};const loadSubList=maker=>{return new Promise(res=>{APIS.postData(API_URL.commom.car,{maker}).then(carResult=>{var _carResult$data;if((carResult===null||carResult===void 0?void 0:(_carResult$data=carResult.data)===null||_carResult$data===void 0?void 0:_carResult$data.length)>0){res(carResult===null||carResult===void 0?void 0:carResult.data);}else{res([]);}}).catch(e=>{res([]);});});};return new Promise((resolve,reject)=>{APIS.postData(API_URL.commom.maker).then(async makerResult=>{var _makerResult$data;if((makerResult===null||makerResult===void 0?void 0:(_makerResult$data=makerResult.data)===null||_makerResult$data===void 0?void 0:_makerResult$data.length)>0){let mlist=makerResult===null||makerResult===void 0?void 0:makerResult.data;for(let i in mlist){let cars=await loadSubList(mlist[i]);if(cars.length>0){result.data.push({maker:mlist[i],cars:cars});}}resolve(result);}else{result.error=\"제조사 데이터가 없습니다.\";resolve(result);}}).catch(()=>{result.error=\"제조사 데이터가 없습니다.\";resolve(result);});});};const filterList=()=>{let filterData=truckList.filter(v=>{let isSelect=true;if(filterCar.maker&&v.maker!=filterCar.maker){isSelect=false;}if(filterCar.car&&v.car!=filterCar.car){isSelect=false;}if(filterType.ton){if(filterType.ton!=Number(v.ton))isSelect=false;}else{if(filterType.range.min&&(filterType.range.min>Number(v.ton)||filterType.range.max<Number(v.ton))){isSelect=false;}}if(filterType.carType&&filterType.carType!=v.type){isSelect=false;}if(filterYear.min&&Number(v.year)<Number(filterYear.min))isSelect=false;if(filterYear.max&&Number(v.year)>Number(filterYear.max))isSelect=false;if(filterDistance.min&&Number(v.distance)<Number(filterDistance.min))isSelect=false;if(filterDistance.max&&Number(v.distance)>Number(filterDistance.max))isSelect=false;if(filterPrice.min&&Number(v.price)<Number(filterPrice.min))isSelect=false;if(filterPrice.max&&Number(v.price)>Number(filterPrice.max))isSelect=false;if(filterLicense.length>0&&filterLicense.indexOf(v.license_type)<0)isSelect=false;return isSelect;});setViewList(filterData);};// 필터\nconst categoryClick=async index=>{if(index==0){let carData=await loadCar();//{ values: \"aa\", labels: \"asdas\" }\nif(!carData.err){dispatch(open({component:/*#__PURE__*/_jsx(MadeOption,{carDatas:carData.data,setValue:filterCar,onChange:v=>{setFilterCar(v);}}),onCancelPress:false,titleviewer:true,title:\"제조사/차종\",button:\"초기화\",buttonStyle:\"reset\",onPress:()=>{dispatch(close());setFilterCar({maker:'',car:''});},noneMt:true}));}else{//제조사/차종 정보 없을경우 처리 - 리셋 \nsetFilterCar({maker:'',car:''});}}else if(index==1){dispatch(open({component:/*#__PURE__*/_jsx(TypeOption,{setValue:filterType,onChange:v=>{console.log(v);setFilterType(v);}}),onCancelPress:false,titleviewer:true,title:\"형태\",button:\"초기화\",buttonStyle:\"reset\",onPress:()=>{dispatch(close());setFilterType({range:{min:null,max:null},ton:\"\",carType:\"\"});},noneMt:true}));}else if(index==2){dispatch(open({component:/*#__PURE__*/_jsx(YearOption,{setValue:filterYear,onChange:v=>{setFilterYear(v);}}),onCancelPress:false,titleviewer:true,title:\"연식\",button:\"초기화\",buttonStyle:\"reset\",onPress:()=>{dispatch(close());setFilterYear({min:null,max:null});},noneMt:true}));}else if(index==3){dispatch(open({component:/*#__PURE__*/_jsx(LengthOption,{setValue:filterDistance,onChange:v=>{setFilterDistance(v);}}),onCancelPress:false,titleviewer:true,title:\"주행거리\",button:\"초기화\",buttonStyle:\"reset\",onPress:()=>{dispatch(close());setFilterDistance({min:null,max:null});},noneMt:true}));}else if(index==4){dispatch(open({component:/*#__PURE__*/_jsx(PriceOption,{setValue:filterPrice,onChange:v=>{setFilterPrice(v);}}),onCancelPress:false,titleviewer:true,title:\"차량가격\",button:\"초기화\",buttonStyle:\"reset\",onPress:()=>{dispatch(close());setFilterPrice({min:null,max:null});},noneMt:true}));}else if(index==5){dispatch(open({component:/*#__PURE__*/_jsx(NumberOption,{setValue:filterLicense,onChange:setFilterLicense}),onCancelPress:false,titleviewer:true,title:\"넘버승계\",button:\"초기화\",buttonStyle:\"reset\",onPress:()=>{dispatch(close());setFilterLicense([]);},noneMt:true}));}};/**\n     * 매물 클릭\n     * @param {string} index \n     */const usedCardClick=index=>{if(isLogin)window.open(\"usedCarInfo?idx=\".concat(index));else dispatch(showLoginPopup({onPress:()=>{dispatch(close());navigate(\"/login\");}}));};//윈도우 가로사이즈 체크\nconst checkWindowWidth=()=>{const width=window.innerWidth;if(width<800){setSrRowHeight(710);}else{setSrRowHeight(355);}};const loadList=()=>{dispatch(loadingflas({loading:true}));APIS.postData(API_URL.usedCar.list,{order:order*1,my:isMyView}).then(result=>{console.log(\"🚀 ~ .then ~ result:\",result);setTruckList(result.data);dispatch(loadingflas({loading:false}));}).catch(e=>{console.log(e);dispatch(loadingflas({loading:false}));});};useEffect(()=>{console.log(\"usedCar render!\");console.log(\"state\",location);if(location.state){if(location.state.isMyView)setIsMyView(true);}checkWindowWidth();window.onresize=function(){checkWindowWidth();};return()=>{console.log(\"usedCar unmount!\");};},[]);useEffect(()=>{console.log(\"🚀 ~ UsedCar ~ truckList:\",truckList);filterList();},[truckList]);useEffect(()=>{loadList();},[order,isMyView]);return/*#__PURE__*/_jsx(Layout,{header:true,actives:\"usedCar\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"usedContain\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"categoryBox\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"categoryBtn \".concat(filterCar.maker&&\"select\"),onClick:()=>categoryClick(0),children:\"\\uC81C\\uC870\\uC0AC/\\uCC28\\uC885\"}),/*#__PURE__*/_jsx(\"div\",{className:\"categoryBtn \".concat((filterType.range.min||filterType.ton||filterType.carType)&&\"select\"),onClick:()=>categoryClick(1),children:\"\\uD615\\uD0DC\"}),/*#__PURE__*/_jsx(\"div\",{className:\"categoryBtn \".concat((filterYear.min||filterYear.max)&&\"select\"),onClick:()=>categoryClick(2),children:\"\\uC5F0\\uC2DD\"}),/*#__PURE__*/_jsx(\"div\",{className:\"categoryBtn \".concat((filterDistance.min||filterDistance.max)&&\"select\"),onClick:()=>categoryClick(3),children:\"\\uC8FC\\uD589\\uAC70\\uB9AC\"}),/*#__PURE__*/_jsx(\"div\",{className:\"categoryBtn \".concat((filterPrice.min||filterPrice.max)&&\"select\"),onClick:()=>categoryClick(4),children:\"\\uCC28\\uB7C9\\uAC00\\uACA9\"}),/*#__PURE__*/_jsx(\"div\",{className:\"categoryBtn \".concat(filterLicense.length>0&&\"select\"),onClick:()=>categoryClick(5),children:\"\\uB118\\uBC84\\uC2B9\\uACC4\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"subCategoryBox\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",alignItems:\"center\",gap:10},children:[/*#__PURE__*/_jsx(Selector,{subselectClass:\"selBox\",values:order,setValues:setOrder,selectData:[{values:1,labels:\"최신순\"},{values:2,labels:\"조회순\"},{values:3,labels:\"관심순\"},{values:4,labels:\"낮은가격순\"},{values:5,labels:\"높은가격순\"}]}),/*#__PURE__*/_jsx(TextCheckBox,{name:\"bmv-check\",text:\"\\uB0B4 \\uAE00 \\uBCF4\\uAE30\",isIcon:true,checked:isMyView,onChange:v=>{setIsMyView(v);}})]}),/*#__PURE__*/_jsx(\"div\",{className:\"sellbtn\",children:/*#__PURE__*/_jsx(Button,{titleimgs:\"/images/icons/plus.svg\",buttonTxt:\"\\uB0B4\\uCC28 \\uD310\\uB9E4\",onPress:()=>{if(isLogin)navigate(\"/usedCarAdd\");else dispatch(showLoginPopup({onPress:()=>{dispatch(close());navigate(\"/login\");}}));}})})]}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:20}}),/*#__PURE__*/_jsx(WindowScroller,{children:_ref2=>{let{height,scrollTop,isScrolling,onChildScroll}=_ref2;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(AutoSizer,{disableHeight:true,children:_ref3=>{let{width}=_ref3;return/*#__PURE__*/_jsx(List,{ref:el=>{window.listEl=el;},autoHeight:true,height:height,isScrolling:isScrolling,onScroll:onChildScroll,overscanRowCount:0,rowCount:Math.ceil(viewList.length/2),rowHeight:srRowHeight,rowRenderer:_ref4=>{let{index,isScrolling,isVisible,key,style}=_ref4;let startIndex=index*2;const row1=viewList[startIndex];const row2=startIndex+1<=viewList.length-1?viewList[startIndex+1]:null;return/*#__PURE__*/_jsx(\"div\",{style:style,children:/*#__PURE__*/_jsxs(\"div\",{className:\"cardBox\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card\",onClick:()=>{usedCardClick(row1===null||row1===void 0?void 0:row1.idx);},children:[(row1===null||row1===void 0?void 0:row1.status)===2&&/*#__PURE__*/_jsx(\"div\",{className:\"soldout-box\",children:\"\\uD310\\uB9E4\\uC644\\uB8CC\"}),/*#__PURE__*/_jsx(\"img\",{className:\"carImage\",src:row1!==null&&row1!==void 0&&row1.thumb?consts.s3url+(row1===null||row1===void 0?void 0:row1.thumb):\"\",onError:DefaultImg}),/*#__PURE__*/_jsxs(\"div\",{className:\"info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"infoTitle\",children:row1===null||row1===void 0?void 0:row1.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"infoSubTitle\",children:[dateShotYearformat(row1===null||row1===void 0?void 0:row1.year),\"/\",row1===null||row1===void 0?void 0:row1.month,\"\\uC2DD \\xB7 \",row1===null||row1===void 0?void 0:row1.transmission,\" \\xB7 \",numFormat(row1===null||row1===void 0?void 0:row1.distance),\"km \\xB7 \",row1===null||row1===void 0?void 0:row1.sido]}),/*#__PURE__*/_jsxs(\"div\",{className:\"infoPrice\",children:[numFormat((row1===null||row1===void 0?void 0:row1.price)+(row1===null||row1===void 0?void 0:row1.license_price)),\" \\uB9CC\\uC6D0\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"status-box\",children:[row1!==null&&row1!==void 0&&row1.license_sell?/*#__PURE__*/_jsxs(\"div\",{className:\"addNumber\",children:[row1===null||row1===void 0?void 0:row1.license_type,\" \\uD3EC\\uD568\"]}):/*#__PURE__*/_jsx(_Fragment,{}),(row1===null||row1===void 0?void 0:row1.status)===99?/*#__PURE__*/_jsx(\"div\",{className:\"saveTag\",children:\"\\uC784\\uC2DC\\uC800\\uC7A5\"}):/*#__PURE__*/_jsx(_Fragment,{})]})]})]}),row2&&/*#__PURE__*/_jsxs(\"div\",{className:\"card\",onClick:()=>{usedCardClick(row2===null||row2===void 0?void 0:row2.idx);},children:[(row2===null||row2===void 0?void 0:row2.status)===2&&/*#__PURE__*/_jsx(\"div\",{className:\"soldout-box\",children:\"\\uD310\\uB9E4\\uC644\\uB8CC\"}),/*#__PURE__*/_jsx(\"img\",{className:\"carImage\",src:row2!==null&&row2!==void 0&&row2.thumb?consts.s3url+(row2===null||row2===void 0?void 0:row2.thumb):\"\",onError:DefaultImg}),/*#__PURE__*/_jsxs(\"div\",{className:\"info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"infoTitle\",children:row2===null||row2===void 0?void 0:row2.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"infoSubTitle\",children:[dateShotYearformat(row2===null||row2===void 0?void 0:row2.year),\"/\",row2===null||row2===void 0?void 0:row2.month,\"\\uC2DD \\xB7 \",row2===null||row2===void 0?void 0:row2.transmission,\" \\xB7 \",numFormat(row2===null||row2===void 0?void 0:row2.distance),\"km \\xB7 \",row2===null||row2===void 0?void 0:row2.sido]}),/*#__PURE__*/_jsxs(\"div\",{className:\"infoPrice\",children:[numFormat((row2===null||row2===void 0?void 0:row2.price)+(row2===null||row2===void 0?void 0:row2.license_price)),\" \\uB9CC\\uC6D0\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"status-box\",children:[row2!==null&&row2!==void 0&&row2.license_sell?/*#__PURE__*/_jsxs(\"div\",{className:\"addNumber\",children:[row2===null||row2===void 0?void 0:row2.license_type,\" \\uD3EC\\uD568\"]}):/*#__PURE__*/_jsx(_Fragment,{}),(row2===null||row2===void 0?void 0:row2.status)===99?/*#__PURE__*/_jsx(\"div\",{className:\"saveTag\",children:\"\\uC784\\uC2DC\\uC800\\uC7A5\"}):/*#__PURE__*/_jsx(_Fragment,{})]})]})]})]})},key);},scrollToIndex:0,scrollTop:scrollTop,width:width});}}),/*#__PURE__*/_jsx(\"div\",{ref:target,style:{width:'100%',height:1}})]});}})]})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}